
---

### ­ЪЊї рЃарЃљрЃА рЃюрЃўрЃерЃюрЃљрЃЋрЃА РђъValueTask рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃћрЃарЃЌрЃ«рЃћрЃџ рЃерЃћрЃўрЃФрЃџрЃћрЃЉрЃљ рЃЊрЃљрЃЋрЃљрЃўрЃЌрЃЮрЃЌРђю

**Task** reference-рЃбрЃўрЃърЃўрЃљ Рєњ рЃерЃћрЃњрЃўрЃФрЃџрЃўрЃљ рЃарЃљрЃЏрЃЊрЃћрЃюрЃ»рЃћрЃарЃЏрЃћ рЃЊрЃљрЃљрЃўрЃЌрЃЮ (`await`) рЃћрЃарЃЌрЃў рЃЊрЃљ рЃўрЃњрЃўрЃЋрЃћ instance:

```csharp
Task<int> t = Task.FromResult(42);

int a = await t;  // Рюћ рЃЏрЃБрЃерЃљрЃЮрЃЉрЃА
int b = await t;  // Рюћ рЃўрЃАрЃћрЃЋ рЃЏрЃБрЃерЃљрЃЮрЃЉрЃА
```

рЃћрЃА рЃўрЃЏрЃўрЃбрЃЮрЃЏ, рЃарЃЮрЃЏ `Task`-рЃўрЃА рЃерЃўрЃњрЃюрЃўрЃЌ рЃерЃћрЃЊрЃћрЃњрЃў рЃўрЃюрЃљрЃ«рЃћрЃЉрЃљ рЃћрЃарЃЌ рЃЮрЃЉрЃўрЃћрЃЦрЃбрЃерЃў рЃЊрЃљ рЃЏрЃўрЃАрЃў рЃЏрЃарЃљрЃЋрЃљрЃџрЃ»рЃћрЃа рЃгрЃљрЃЎрЃўрЃЌрЃ«рЃЋрЃљ рЃерЃћрЃАрЃљрЃФрЃџрЃћрЃЉрЃћрЃџрЃўрЃљ.

---

**ValueTask** struct-рЃўрЃљ Рєњ рЃерЃћрЃўрЃФрЃџрЃћрЃЉрЃљ:

- рЃърЃўрЃарЃЊрЃљрЃърЃўрЃа рЃўрЃюрЃљрЃ«рЃљрЃЋрЃЊрЃћрЃА `TResult` рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЉрЃљрЃА (рЃЌрЃБ рЃАрЃўрЃюрЃЦрЃарЃЮрЃюрЃБрЃџрЃљрЃЊрЃљрЃљ рЃЏрЃќрЃљрЃЊ), рЃљрЃю
    
- рЃўрЃюрЃљрЃ«рЃљрЃЋрЃЊрЃћрЃА reference-рЃА underlying `Task<TResult>`-рЃќрЃћ.
    

рЃЌрЃБ рЃўрЃА рЃърЃўрЃарЃЋрЃћрЃџ рЃЋрЃљрЃарЃўрЃљрЃюрЃбрЃерЃўрЃљ (рЃљрЃюрЃБ рЃърЃўрЃарЃЊрЃљрЃърЃўрЃа рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЉрЃљрЃА рЃўрЃюрЃљрЃ«рЃљрЃЋрЃА), рЃЏрЃљрЃерЃўрЃю **await-рЃўрЃА рЃерЃћрЃЏрЃЊрЃћрЃњ result рЃБрЃЉрЃарЃљрЃџрЃЮрЃЊ рЃўрЃ«рЃљрЃарЃ»рЃћрЃЉрЃљ** рЃЊрЃљ рЃЏрЃћрЃЮрЃарЃћрЃЊ рЃарЃЮрЃЏ рЃАрЃфрЃљрЃЊрЃЮ await Рєњ рЃЦрЃфрЃћрЃЋрЃљ **рЃњрЃљрЃюрЃБрЃАрЃљрЃќрЃдрЃЋрЃарЃћрЃџрЃў** рЃўрЃЦрЃюрЃћрЃЉрЃљ.

рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃў:

```csharp
ValueTask<int> v = new ValueTask<int>(42);

int a = await v;  // Рюћ рЃЏрЃБрЃерЃљрЃЮрЃЉрЃА, рЃЊрЃљрЃњрЃўрЃЉрЃарЃБрЃюрЃћрЃЉрЃА 42
int b = await v;  // Рџа рЃерЃћрЃўрЃФрЃџрЃћрЃЉрЃљ exception, рЃерЃћрЃўрЃФрЃџрЃћрЃЉрЃљ рЃюрЃБрЃџрЃўрЃф, рЃерЃћрЃўрЃФрЃџрЃћрЃЉрЃљ рЃўрЃАрЃћрЃЋ 42 (рЃљрЃарЃљрЃњрЃљрЃарЃљрЃюрЃбрЃўрЃарЃћрЃЉрЃБрЃџрЃў!)
```

---

### ­ЪЊї рЃарЃЮрЃЊрЃўрЃА рЃ«рЃЊрЃћрЃЉрЃљ РђърЃћрЃарЃЌрЃў awaitРђю рЃарЃћрЃљрЃџрЃБрЃарЃў рЃерЃћрЃќрЃдрЃБрЃЊрЃЋрЃљ?

- рЃЌрЃБ ValueTask рЃАрЃўрЃюрЃЦрЃарЃЮрЃюрЃБрЃџрЃљрЃЊрЃљрЃљ рЃерЃћрЃЦрЃЏрЃюрЃўрЃџрЃў (`new ValueTask<T>(value)`), **await рЃћрЃарЃЌрЃ«рЃћрЃџ** рЃерЃћрЃўрЃФрЃџрЃћрЃЉрЃљ.
    
- рЃЌрЃБ ValueTask рЃўрЃЉрЃарЃБрЃюрЃћрЃЉрЃА рЃарЃћрЃљрЃџрЃБрЃа Task-рЃА (`new ValueTask<T>(someTask)`), рЃЏрЃљрЃерЃўрЃю underlying Task behaves normally Рєњ рЃерЃћрЃњрЃўрЃФрЃџрЃўрЃљ рЃарЃљрЃЏрЃЊрЃћрЃюрЃ»рЃћрЃарЃљрЃф рЃњрЃўрЃюрЃЊрЃљ рЃЊрЃљрЃљрЃўрЃЌрЃЮ.
    

рЃЏрЃљрЃњрЃарЃљрЃЏ рЃарЃљрЃЊрЃњрЃљрЃю рЃЮрЃарЃўрЃЋрЃћ рЃЦрЃћрЃўрЃАрЃў рЃерЃћрЃАрЃљрЃФрЃџрЃћрЃЉрЃћрЃџрЃўрЃљ, **.NET рЃњрЃБрЃюрЃЊрЃў рЃњрЃўрЃарЃЕрЃћрЃЋрЃА**, рЃарЃЮрЃЏ **рЃљрЃарЃљрЃАрЃЮрЃЊрЃћрЃА** рЃћрЃфрЃљрЃЊрЃЮ ValueTask-рЃќрЃћ рЃЏрЃарЃљрЃЋрЃџрЃ»рЃћрЃа await РђЊ рЃгрЃћрЃАрЃљрЃЊ рЃЏрЃўрЃўрЃЕрЃюрЃўрЃћ Рђъawait рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃћрЃарЃЌрЃ«рЃћрЃџРђю.

---

### ­ЪЊї рЃарЃљрЃА рЃюрЃўрЃерЃюрЃљрЃЋрЃА рЃърЃарЃљрЃЦрЃбрЃўрЃЎрЃБрЃџрЃљрЃЊ?

- **Task** рЃерЃћрЃњрЃўрЃФрЃџрЃўрЃљ рЃЏрЃарЃљрЃЋрЃљрЃџрЃ»рЃћрЃа await-рЃЮ, рЃБрЃАрЃљрЃцрЃарЃЌрЃ«рЃЮрЃљ.
    
- **ValueTask** Рєњ рЃњрЃљрЃЏрЃЮрЃўрЃДрЃћрЃюрЃћ рЃћрЃарЃЌрЃў await Рєњ рЃЏрЃўрЃўрЃдрЃћ result Рєњ рЃЊрЃљрЃљрЃАрЃарЃБрЃџрЃћ.
    

рЃЌрЃБ рЃљрЃБрЃфрЃўрЃџрЃћрЃЉрЃџрЃљрЃЊ рЃњрЃГрЃўрЃарЃЊрЃћрЃЉрЃљ рЃўрЃњрЃўрЃЋрЃћ рЃЮрЃърЃћрЃарЃљрЃфрЃўрЃўрЃА рЃерЃћрЃЊрЃћрЃњрЃў рЃЏрЃарЃљрЃЋрЃљрЃџрЃ»рЃћрЃа, рЃњрЃљрЃЏрЃЮрЃўрЃДрЃћрЃюрЃћ:

```csharp
var result = await valueTask; 
// result рЃБрЃЎрЃЋрЃћ рЃфрЃЋрЃџрЃљрЃЊрЃерЃўрЃљ рЃЊрЃљ рЃарЃљрЃЏрЃЊрЃћрЃюрЃ»рЃћрЃарЃљрЃф рЃњрЃўрЃюрЃЊрЃљ рЃњрЃљрЃЏрЃЮрЃўрЃДрЃћрЃюрЃћрЃЉ
Console.WriteLine(result);
Console.WriteLine(result);
```

---

### Рџа рЃърЃарЃЮрЃЉрЃџрЃћрЃЏрЃБрЃарЃў рЃЦрЃћрЃўрЃАрЃћрЃЉрЃў

```csharp
// рЃфрЃБрЃЊрЃў рЃърЃарЃљрЃЦрЃбрЃўрЃЎрЃљ
int a = await service.GetDataAsync(1);
int b = await service.GetDataAsync(1); // рЃўрЃАрЃћрЃЋ рЃўрЃФрЃљрЃ«рЃћрЃЉрЃА рЃЏрЃћрЃЌрЃЮрЃЊрЃА, ValueTask-рЃА await рЃЮрЃарЃ»рЃћрЃа рЃљрЃЎрЃћрЃЌрЃћрЃЉ
```

---

РюЁ рЃАрЃгрЃЮрЃарЃў рЃњрЃќрЃљ:

```csharp
var result = await service.GetDataAsync(1);
int a = result;
int b = result; // рЃарЃљрЃЏрЃЊрЃћрЃюрЃ»рЃћрЃарЃљрЃф рЃњрЃўрЃюрЃЊрЃљ, рЃњрЃљрЃЏрЃЮрЃўрЃДрЃћрЃюрЃћрЃЉ result-рЃА, рЃЏрЃљрЃњрЃарЃљрЃЏ await рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃћрЃарЃЌрЃ«рЃћрЃџ рЃ«рЃЊрЃћрЃЉрЃљ
```

---

­ЪЉЅ рЃЏрЃЮрЃЎрЃџрЃћрЃЊ:

- **ValueTask** = await рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃћрЃарЃЌрЃ«рЃћрЃџ.
    
- **Task** = await рЃарЃљрЃЏрЃЊрЃћрЃюрЃ»рЃћрЃарЃљрЃф рЃњрЃўрЃюрЃЊрЃљ.
    
- рЃЌрЃБ рЃњрЃГрЃўрЃарЃЊрЃћрЃЉрЃљ рЃЏрЃарЃљрЃЋрЃљрЃџрЃ»рЃћрЃа await, ValueTask Рєњ Task-рЃљрЃЊ рЃњрЃљрЃЊрЃљрЃљрЃЦрЃфрЃўрЃћ `AsTask()`.
    
